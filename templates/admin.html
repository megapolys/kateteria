{% extends "base.html" %}
{% import 'cake.html' as macros %}

{% block content %}
    <div class="container start-50" style="padding: 100px 100px 100px 100px;">
        <div class="row">
            <div class="col-10">
                <button type="button" class="btn btn-success" data-bs-toggle="modal"
                        data-bs-target="#createCakeForm" onclick="createBtnClicked();">
                    Добавить торт
                </button>
            </div>
            <div class="col-2">
                <a href="/admin_login?action=logout" role="button" class="btn btn-warning">Выйти</a>
            </div>
        </div>
        <div class="row g-4 gy-3 mt-0">
            {% for cake in cakes %}
                {{ macros.render_cake(cake, True) }}
            {% endfor %}
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="createCakeForm" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">Добавить торт</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <form method="post" class="row g-3" action="/create_cake" enctype="multipart/form-data" id="cakeForm">
                        {{ form.csrf_token() }}
                        {{ form.cake_id() }}
                        <div class="mb-3">
                            {{ form.title.label(class="visually-hidden") }}
                            {{ form.title(placeholder=form.title.label.text,class="w-100") }}
                        </div>
                        <div class="mb-3">
                            {{ form.description.label(class="visually-hidden") }}
                            {{ form.description(placeholder=form.description.label.text,class="w-100") }}
                        </div>
                        <div class="mb-3">
                            {{ form.images.label(class="visually-hidden") }}
                            {{ form.images(placeholder=form.images.label.text) }}
                        </div>
                        <div class="mb-3">
                            {{ form.submit(class="btn btn-primary mb-3") }}
                        </div>
                        {{ message }}
                    </form>
                </div>
                <!--      <div class="modal-footer">-->
                <!--        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>-->
                <!--        <button type="button" class="btn btn-primary">Understood</button>-->
                <!--      </div>-->
            </div>
        </div>
    </div>

    <script>

        var cakes_js = [];
        {% for i in range(cakes | length) %}
        cakes_js.push({'id': {{ cakes[i]['id'] }}, 'title': '{{ cakes[i]['title'] }}', 'desc': '{{ cakes[i]['desc']}}' });
        {% endfor %}

        function editBtnClicked(cake_id) {
            var input = document.getElementById("cakeId");
            input.value = cake_id;

            var form = document.getElementById("cakeForm");
            form.action = '/update_cake/' + cake_id;

            var button = document.getElementById("cakeSubmit");
            button.value = 'Изменить';

            var cake = null;
            for (var i = 0; i < cakes_js.length; i++)
                if (cakes_js[i]['id'] == cake_id) {
                    cake = cakes_js[i];
                    break;
                }

            var name = document.getElementById("cakeName");
            name.value = cake['title'];

            var desc = document.getElementById("cakeDesc");
            desc.value = cake['desc'];
        }

        function createBtnClicked() {
            var input = document.getElementById("cakeId");
            input.value = -1;

            var form = document.getElementById("cakeForm");
            form.action = '/create_cake'

            var button = document.getElementById("cakeSubmit");
            button.value = 'Добавить';

            var name = document.getElementById("cakeName");
            name.value = '';

            var desc = document.getElementById("cakeDesc");
            desc.value = '';
        }
    </script>

{% endblock %}
